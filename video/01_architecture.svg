<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450" font-family="'Courier New', monospace">

  <defs>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="6" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <linearGradient id="dataFlow" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#4fc3f7" stop-opacity="0"/>
      <stop offset="50%" stop-color="#4fc3f7" stop-opacity="1"/>
      <stop offset="100%" stop-color="#4fc3f7" stop-opacity="0"/>
    </linearGradient>
    <linearGradient id="blockGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#3a3a5e"/>
      <stop offset="100%" stop-color="#2a2a4e"/>
    </linearGradient>
  </defs>

  <style>
    .bg { fill: #1a1a2e; }

    /* Title */
    .title {
      fill: #e0e0e0; font-size: 24px; font-weight: bold;
      opacity: 0;
      animation: fadeSlideDown 1s ease-out 0.3s forwards;
    }
    .subtitle {
      fill: #888; font-size: 14px;
      opacity: 0;
      animation: fadeIn 0.8s ease 1s forwards;
    }

    @keyframes fadeSlideDown {
      from { opacity: 0; transform: translateY(-15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn { to { opacity: 1; } }

    /* Flow boxes */
    .flow-box {
      fill: url(#blockGrad);
      stroke: #4fc3f7;
      stroke-width: 2;
      rx: 8;
      opacity: 0;
    }
    .flow-label {
      fill: #e0e0e0;
      font-size: 14px;
      text-anchor: middle;
      opacity: 0;
    }
    .flow-sublabel {
      fill: #888;
      font-size: 10px;
      text-anchor: middle;
      opacity: 0;
    }

    /* Sequential box reveals */
    .box1 { animation: boxReveal 0.6s ease-out 1.5s forwards; }
    .box2 { animation: boxReveal 0.6s ease-out 2.5s forwards; }
    .box3 { animation: boxReveal 0.6s ease-out 3.5s forwards; }
    .box4 { animation: boxReveal 0.6s ease-out 4.5s forwards; }
    .box5 { animation: boxReveal 0.6s ease-out 5.5s forwards; }

    .label1 { animation: fadeIn 0.4s ease 1.8s forwards; }
    .label2 { animation: fadeIn 0.4s ease 2.8s forwards; }
    .label3 { animation: fadeIn 0.4s ease 3.8s forwards; }
    .label4 { animation: fadeIn 0.4s ease 4.8s forwards; }
    .label5 { animation: fadeIn 0.4s ease 5.8s forwards; }

    @keyframes boxReveal {
      0% { opacity: 0; transform: scale(0.8); }
      60% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* Arrows */
    .arrow {
      fill: none;
      stroke: #4fc3f7;
      stroke-width: 2;
      stroke-dasharray: 80;
      stroke-dashoffset: 80;
      marker-end: url(#arrowhead);
    }
    .arrow1 { animation: drawArrow 0.5s ease 2.2s forwards; }
    .arrow2 { animation: drawArrow 0.5s ease 3.2s forwards; }
    .arrow3 { animation: drawArrow 0.5s ease 4.2s forwards; }
    .arrow4 { animation: drawArrow 0.5s ease 5.2s forwards; }

    @keyframes drawArrow { to { stroke-dashoffset: 0; } }

    /* Transformer block expansion */
    .transformer-detail {
      opacity: 0;
    }
    .transformer-expand {
      animation: expandIn 0.8s ease 6.5s forwards;
    }
    @keyframes expandIn {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .inner-box {
      fill: #2a2a4e;
      stroke: #ff8a65;
      stroke-width: 1.5;
      rx: 4;
    }
    .inner-label {
      fill: #ff8a65;
      font-size: 11px;
      text-anchor: middle;
    }

    /* Data flow particles */
    .particle {
      fill: #4fc3f7;
      opacity: 0;
    }
    .p1 { animation: flowParticle 3s ease-in-out 7s infinite; }
    .p2 { animation: flowParticle 3s ease-in-out 7.3s infinite; }
    .p3 { animation: flowParticle 3s ease-in-out 7.6s infinite; }

    @keyframes flowParticle {
      0% { opacity: 0; cx: 80; }
      10% { opacity: 0.8; }
      90% { opacity: 0.8; }
      100% { opacity: 0; cx: 720; }
    }

    /* Code hint */
    .code-hint {
      fill: #76ff03;
      font-size: 16px;
      font-weight: bold;
      opacity: 0;
      animation: codeReveal 1.5s ease 8s forwards;
    }
    .code-file {
      fill: #888;
      font-size: 12px;
      opacity: 0;
      animation: fadeIn 0.8s ease 8.5s forwards;
    }
    @keyframes codeReveal {
      0% { opacity: 0; letter-spacing: 5px; }
      50% { letter-spacing: 2px; }
      100% { opacity: 1; letter-spacing: 0; }
    }

    /* Pulse effect on active block */
    .pulse-ring {
      fill: none;
      stroke: #4fc3f7;
      stroke-width: 2;
      opacity: 0;
    }
    .pulse1 { animation: pulseOut 1s ease-out 2s forwards; }
    .pulse2 { animation: pulseOut 1s ease-out 3s forwards; }
    .pulse3 { animation: pulseOut 1s ease-out 4s forwards; }
    .pulse4 { animation: pulseOut 1s ease-out 5s forwards; }
    .pulse5 { animation: pulseOut 1s ease-out 6s forwards; }

    @keyframes pulseOut {
      0% { opacity: 0.6; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.3); }
    }
  </style>

  <!-- Arrowhead marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4fc3f7"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect class="bg" width="800" height="450" rx="8"/>

  <!-- Title -->
  <text class="title" x="400" y="45" text-anchor="middle">GPT Architecture</text>
  <text class="subtitle" x="400" y="68" text-anchor="middle">The complete forward pass in 5 stages</text>

  <!-- Main flow: Token -> Embedding -> Transformer Blocks -> LN -> Output -->

  <!-- Box 1: Token Input -->
  <g transform="translate(60, 140)">
    <rect class="flow-box box1" width="100" height="60" x="0" y="0"/>
    <rect class="pulse-ring pulse1" width="100" height="60" x="0" y="0" rx="8"/>
    <text class="flow-label label1" x="50" y="35">Token</text>
    <text class="flow-sublabel label1" x="50" y="50">"Hello"</text>
  </g>

  <!-- Arrow 1 -->
  <path class="arrow arrow1" d="M 165 170 L 210 170"/>

  <!-- Box 2: Embedding -->
  <g transform="translate(215, 140)">
    <rect class="flow-box box2" width="100" height="60" x="0" y="0"/>
    <rect class="pulse-ring pulse2" width="100" height="60" x="0" y="0" rx="8"/>
    <text class="flow-label label2" x="50" y="30">Embedding</text>
    <text class="flow-sublabel label2" x="50" y="45">+ Position</text>
  </g>

  <!-- Arrow 2 -->
  <path class="arrow arrow2" d="M 320 170 L 365 170"/>

  <!-- Box 3: Transformer Blocks (larger) -->
  <g transform="translate(370, 120)">
    <rect class="flow-box box3" width="140" height="100" x="0" y="0"/>
    <rect class="pulse-ring pulse3" width="140" height="100" x="0" y="0" rx="8"/>
    <text class="flow-label label3" x="70" y="35">Transformer</text>
    <text class="flow-sublabel label3" x="70" y="52">x N blocks</text>
  </g>

  <!-- Arrow 3 -->
  <path class="arrow arrow3" d="M 515 170 L 560 170"/>

  <!-- Box 4: Layer Norm -->
  <g transform="translate(565, 140)">
    <rect class="flow-box box4" width="80" height="60" x="0" y="0"/>
    <rect class="pulse-ring pulse4" width="80" height="60" x="0" y="0" rx="8"/>
    <text class="flow-label label4" x="40" y="35">LN</text>
  </g>

  <!-- Arrow 4 -->
  <path class="arrow arrow4" d="M 650 170 L 695 170"/>

  <!-- Box 5: Output -->
  <g transform="translate(700, 140)">
    <rect class="flow-box box5" width="80" height="60" x="0" y="0"/>
    <rect class="pulse-ring pulse5" width="80" height="60" x="0" y="0" rx="8"/>
    <text class="flow-label label5" x="40" y="30">Output</text>
    <text class="flow-sublabel label5" x="40" y="45">logits</text>
  </g>

  <!-- Transformer block expansion (appears below) -->
  <g class="transformer-detail transformer-expand" transform="translate(370, 260)">
    <text fill="#888" font-size="11" x="70" y="0" text-anchor="middle">Inside each block:</text>

    <!-- Attention box -->
    <rect class="inner-box" x="0" y="15" width="60" height="40"/>
    <text class="inner-label" x="30" y="40">Attn</text>

    <!-- Plus sign -->
    <text fill="#888" x="72" y="40" font-size="16">+</text>

    <!-- MLP box -->
    <rect class="inner-box" x="85" y="15" width="55" height="40"/>
    <text class="inner-label" x="112" y="40">MLP</text>

    <!-- Residual arrow -->
    <path fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,2"
          d="M 30 60 L 30 75 L 112 75 L 112 60"/>
    <text fill="#666" font-size="9" x="71" y="85" text-anchor="middle">residual</text>
  </g>

  <!-- Flowing data particles -->
  <circle class="particle p1" cy="170" r="4" filter="url(#softGlow)"/>
  <circle class="particle p2" cy="170" r="3" filter="url(#softGlow)"/>
  <circle class="particle p3" cy="170" r="5" filter="url(#softGlow)"/>

  <!-- Code hint at bottom -->
  <text class="code-hint" x="400" y="390" text-anchor="middle">~300 lines of Python</text>
  <text class="code-file" x="400" y="410" text-anchor="middle">model.py</text>

  <!-- Decorative corner brackets -->
  <g opacity="0.3">
    <path fill="none" stroke="#4fc3f7" stroke-width="1" d="M 20 20 L 20 40 M 20 20 L 40 20"/>
    <path fill="none" stroke="#4fc3f7" stroke-width="1" d="M 780 20 L 780 40 M 780 20 L 760 20"/>
    <path fill="none" stroke="#4fc3f7" stroke-width="1" d="M 20 430 L 20 410 M 20 430 L 40 430"/>
    <path fill="none" stroke="#4fc3f7" stroke-width="1" d="M 780 430 L 780 410 M 780 430 L 760 430"/>
  </g>

</svg>
